<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Login - Fórmula DS3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        :root{ --bg:#020617; --card:#020617; --text:#f9fafb; --muted:#9ca3af; --accent:#ef4444; }
        *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",system-ui;}
        body{min-height:100vh;background:radial-gradient(circle at top,#1f2937,#020617);color:var(--text);display:flex;align-items:center;justify-content:center;padding:16px;}
        .card{background:linear-gradient(135deg,#020617,#0f172a);border-radius:20px;padding:24px 22px;width:100%;max-width:380px;border:1px solid rgba(148,163,184,0.35);box-shadow:0 18px 35px rgba(0,0,0,0.7);}
        .logo-area{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:18px;}
        .logo-circle{width:80px;height:80px;border-radius:50%;background:#020617;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;overflow:hidden;box-shadow:0 0 14px rgba(239,68,68,0.6);}
        .logo-circle img{width:90px;}
        h1{font-size:20px;margin-bottom:4px;text-align:center;}
        p.subtitle{font-size:13px;color:var(--muted);text-align:center;}
        .form-group{margin-top:14px;display:flex;flex-direction:column;gap:4px;font-size:13px;}
        label{color:var(--muted);}
        input{padding:9px 10px;border-radius:10px;border:1px solid rgba(148,163,184,0.6);background:#020617;color:var(--text);font-size:13px;}
        input::placeholder{color:#6b7280;}
        .btn{margin-top:16px;width:100%;padding:10px 0;border-radius:999px;border:none;background:linear-gradient(135deg,#f97316,#ef4444);color:white;font-weight:600;text-transform:uppercase;letter-spacing:.7px;cursor:pointer;box-shadow:0 12px 25px rgba(248,113,113,0.45);}
        .btn:hover{transform:translateY(-1px);}
        .msg{margin-top:10px;font-size:12px;}
        .msg-erro{color:#fca5a5;}
        .msg-ok{color:#bbf7d0;}
    </style>
</head>
<body>
<div class="card">
    <div class="logo-area">
        <div class="logo-circle">
            <img src="logo-fds3.png" alt="FDS3">
        </div>
        <h1>Fórmula DS3</h1>
        <p class="subtitle">Faça login para acessar o sistema</p>
    </div>

    <div class="form-group">
        <label for="email">E-mail</label>
        <input id="email" type="email" placeholder="seuemail@escola.pr.gov.br">
    </div>
    <div class="form-group">
        <label for="senha">Senha</label>
        <input id="senha" type="password" placeholder="Sua senha">
    </div>

    <button class="btn" id="btnLogin">Entrar</button>
    <div id="msg" class="msg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAmm8PRi_1OJoufaSBCooGb4cQ3HQZGT0o",
  authDomain: "eeba-9dfd0.firebaseapp.com",
  databaseURL: "https://eeba-9dfd0-default-rtdb.firebaseio.com",
  projectId: "eeba-9dfd0",
  storageBucket: "eeba-9dfd0.firebasestorage.app",
  messagingSenderId: "947616785928",
  appId: "1:947616785928:web:37b39b183bbd1acc9813bd"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);
const usuariosRef = ref(db, "usuarios");

const MASTER_EMAIL = "dos.santos.raphael@escola.pr.gov.br";
const MASTER_SENHA = "1017069892";

const btnLogin = document.getElementById("btnLogin");
const msg      = document.getElementById("msg");

btnLogin.addEventListener("click", async () => {
    const email = document.getElementById("email").value.trim();
    const senha = document.getElementById("senha").value.trim();
    msg.textContent = "";
    msg.className   = "msg";

    if(!email || !senha){
        msg.textContent = "Preencha e-mail e senha.";
        msg.classList.add("msg-erro");
        return;
    }

    // Master fixo
    if(email === MASTER_EMAIL && senha === MASTER_SENHA){
        const usuario = { email, role:"master" };
        localStorage.setItem("usuarioLogado", JSON.stringify(usuario));
        msg.textContent = "Login master realizado!";
        msg.classList.add("msg-ok");
        window.location.href = "admin.html";
        return;
    }

    try{
        const snap = await get(usuariosRef);
        let encontrado = null;

        if(snap.exists()){
            snap.forEach(child => {
                const u = child.val();
                if(u.email === email && u.senha === senha){
                    encontrado = { email:u.email, role:u.role || "recepcao" };
                }
            });
        }

        if(!encontrado){
            msg.textContent = "Usuário ou senha inválidos.";
            msg.classList.add("msg-erro");
            return;
        }

        localStorage.setItem("usuarioLogado", JSON.stringify(encontrado));
        msg.textContent = "Login realizado!";
        msg.classList.add("msg-ok");

        if(encontrado.role === "recepcao"){
            window.location.href = "recepcao.html";
        }else if(encontrado.role === "corrida"){
            window.location.href = "corrida.html";
        }else if(encontrado.role === "admin"){
            window.location.href = "admin.html";
        }else{
            window.location.href = "corrida.html";
        }

    }catch(err){
        console.error(err);
        msg.textContent = "Erro ao consultar usuários.";
        msg.classList.add("msg-erro");
    }
});
</script>
</body>
</html>
