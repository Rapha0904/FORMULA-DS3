<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Recepção - Cadastro & Palpite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root{
            --bg:#020617;
            --card:#020617;
            --text:#f9fafb;
            --muted:#9ca3af;
            --accent:#ef4444;
            --accent-soft:#f97316;
        }
        *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",system-ui;}
        body{
            min-height:100vh;
            background:radial-gradient(circle at top,#1f2937,#020617);
            color:var(--text);
        }
        header{
            padding:12px 16px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            flex-wrap:wrap;
            gap:8px;
            border-bottom:1px solid rgba(148,163,184,0.35);
            background:rgba(2,6,23,0.95);
            backdrop-filter:blur(10px);
        }
        .logo-area{
            display:flex;
            align-items:center;
            gap:10px;
        }
        .logo-circle{
            width:48px;height:48px;border-radius:50%;
            background:#020617;border:2px solid var(--accent);
            display:flex;align-items:center;justify-content:center;
            overflow:hidden;box-shadow:0 0 10px rgba(239,68,68,0.5);
        }
        .logo-circle img{width:60px;}
        .logo-text{display:flex;flex-direction:column;gap:2px;}
        .logo-text strong{font-size:15px;}
        .logo-text span{font-size:11px;color:var(--muted);text-transform:uppercase;}
        nav{
            display:flex;align-items:center;gap:8px;flex-wrap:wrap;
        }
        nav a{
            font-size:12px;color:#93c5fd;text-decoration:none;
            padding:4px 10px;border-radius:999px;
            border:1px solid rgba(147,197,253,0.7);
        }
        nav a:hover{background:rgba(37,99,235,0.2);}
        .user-info{font-size:11px;color:var(--muted);}
        main{
            max-width:900px;margin:18px auto 26px;padding:0 12px;
        }
        .card{
            background:radial-gradient(circle at top,#020617,#020617 40%,#030712);
            border-radius:20px;
            padding:18px 16px 22px;
            border:1px solid rgba(148,163,184,0.45);
            box-shadow:0 20px 40px rgba(0,0,0,0.75);
        }
        .card-header{margin-bottom:10px;}
        .tag{
            font-size:11px;color:var(--muted);
            text-transform:uppercase;letter-spacing:1px;
        }
        h2{font-size:19px;}
        .description{
            font-size:12px;color:var(--muted);margin-top:4px;
        }
        .form-grid{
            display:grid;
            grid-template-columns:repeat(2,minmax(0,1fr));
            gap:14px;
            margin-top:14px;
        }
        @media(max-width:700px){
            .form-grid{grid-template-columns:1fr;}
        }
        .form-group{display:flex;flex-direction:column;gap:5px;font-size:13px;}
        label{color:var(--muted);font-weight:500;}
        input, select{
            padding:9px 11px;border-radius:12px;
            border:1px solid rgba(148,163,184,0.7);
            background:rgba(15,23,42,0.9);
            color:var(--text);font-size:13px;
            transition:border .15s, box-shadow .15s, background .15s;
            width:100%;
        }
        input::placeholder{color:#6b7280;}
        input:focus, select:focus{
            outline:none;
            border-color:var(--accent-soft);
            box-shadow:0 0 0 1px rgba(249,115,22,0.7);
            background:#020617;
        }
        select{
            appearance:none;
            -webkit-appearance:none;
            -moz-appearance:none;
            background-image:
                linear-gradient(45deg, transparent 50%, #f97316 50%),
                linear-gradient(135deg, #f97316 50%, transparent 50%);
            background-position:
                calc(100% - 16px) calc(50% - 3px),
                calc(100% - 10px) calc(50% - 3px);
            background-size:6px 6px;
            background-repeat:no-repeat;
        }
        .actions{
            margin-top:16px;
            display:flex;
            justify-content:flex-end;
        }
        .btn{
            padding:9px 20px;border-radius:999px;border:none;
            background:linear-gradient(135deg,#f97316,#ef4444);
            color:white;font-size:13px;font-weight:600;
            text-transform:uppercase;letter-spacing:.6px;cursor:pointer;
            box-shadow:0 14px 28px rgba(248,113,113,0.55);
        }
        .btn:hover{transform:translateY(-1px);}
        #msgCadastro{margin-top:10px;font-size:12px;}
        .ok{color:#4ade80;}
        .erro{color:#fca5a5;}
    </style>
</head>
<body>
<header>
    <div class="logo-area">
        <div class="logo-circle">
            <img src="logo-fds3.png" alt="FDS3">
        </div>
        <div class="logo-text">
            <strong>Fórmula DS3</strong>
            <span>Recepção • Cadastro & palpite</span>
        </div>
    </div>
    <nav>
        <span class="user-info" id="infoUser"></span>
        <a href="admin.html">Admin</a>
        <a href="corrida.html">Corrida</a>
        <a href="index.html" onclick="localStorage.removeItem('usuarioLogado')">Sair</a>
    </nav>
</header>

<main>
    <section class="card">
        <div class="card-header">
            <span class="tag">Entrada de participantes</span>
            <h2>Cadastro + escolha de palpite</h2>
            <p class="description">
                A recepção registra quem está entrando no evento e já define em qual carrinho a pessoa está dando o palpite.
            </p>
        </div>

        <form id="formCadastro">
            <div class="form-grid">
                <div class="form-group">
                    <label for="nome">Nome completo</label>
                    <input id="nome" type="text" placeholder="Ex: Raphael Santos" required>
                </div>
                <div class="form-group">
                    <label for="turma">Turma / Setor</label>
                    <input id="turma" type="text" placeholder="Ex: 2º ADS, Coordenação" required>
                </div>
                <div class="form-group">
                    <label for="tipo">Categoria</label>
                    <select id="tipo" required>
                        <option value="">Selecione...</option>
                        <option value="Visitante">Visitante</option>
                        <option value="Avaliador">Avaliador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="carro">Carrinho escolhido (palpite)</label>
                    <select id="carro" required>
                        <option value="">Selecione...</option>
                        <option value="carro1">Carro 1 • Silver Arrow</option>
                        <option value="carro2">Carro 2 • Orange Blaze</option>
                        <option value="carro3">Carro 3 • Red Scuderia</option>
                    </select>
                </div>
            </div>
            <div class="actions">
                <button class="btn" type="submit">Registrar entrada</button>
            </div>
            <div id="msgCadastro"></div>
        </form>
    </section>
</main>

<script type="module">
    // Permite recepcao, admin, master
    const userData = localStorage.getItem("usuarioLogado");
    if(!userData){
        alert("Faça login primeiro.");
        window.location.href = "index.html";
    }else{
        const u = JSON.parse(userData);
        if(u.role !== "recepcao" && u.role !== "admin" && u.role !== "master"){
            alert("Você não tem acesso à página de recepção.");
            window.location.href = "index.html";
        }else{
            const info =
                u.role === "master" ? "(MASTER)" :
                u.role === "admin"  ? "(ADMIN)"  :
                                      "(RECEPÇÃO)";
            document.getElementById("infoUser").textContent =
                `Logado como: ${u.email} ${info}`;
        }
    }

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAmm8PRi_1OJoufaSBCooGb4cQ3HQZGT0o",
      authDomain: "eeba-9dfd0.firebaseapp.com",
      databaseURL: "https://eeba-9dfd0-default-rtdb.firebaseio.com",
      projectId: "eeba-9dfd0",
      storageBucket: "eeba-9dfd0.firebasestorage.app",
      messagingSenderId: "947616785928",
      appId: "1:947616785928:web:37b39b183bbd1acc9813bd"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);
    const apostasRef = ref(db, "apostas");

    const formCadastro = document.getElementById("formCadastro");
    const msgCadastro  = document.getElementById("msgCadastro");

    formCadastro.addEventListener("submit", async (e) => {
        e.preventDefault();
        msgCadastro.textContent = "";
        msgCadastro.className = "";

        const nome  = document.getElementById("nome").value.trim();
        const turma = document.getElementById("turma").value.trim();
        const tipo  = document.getElementById("tipo").value;
        const carro = document.getElementById("carro").value;

        if(!nome || !turma || !tipo || !carro){
            msgCadastro.textContent = "Preencha todos os campos.";
            msgCadastro.className = "erro";
            return;
        }

        const novaAposta = {
            nome,
            turma,
            tipo,
            carro,
            dataHora: new Date().toISOString()
        };

        try{
            await push(apostasRef, novaAposta);
            msgCadastro.textContent = "Entrada registrada e palpite salvo!";
            msgCadastro.className = "ok";
            formCadastro.reset();
        }catch(err){
            console.error(err);
            msgCadastro.textContent = "Erro ao salvar no Firebase.";
            msgCadastro.className = "erro";
        }
    });
</script>
</body>
</html>
